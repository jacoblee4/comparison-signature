// Generate PDF
try {
    gs.info('SIGNATURE HELPER PDF: Instantiating PDFGenerationAPI...');
    var pdfGenerator = new sn_pdfgeneratorutils.PDFGenerationAPI();
    
    gs.info('SIGNATURE HELPER PDF: Calling convertToPDF...');
    var pdfOutput = pdfGenerator.convertToPDF(htmlContent);
    
    gs.info('SIGNATURE HELPER PDF: convertToPDF completed, checking result...');
    gs.info('SIGNATURE HELPER PDF: pdfOutput type = ' + typeof pdfOutput);
    gs.info('SIGNATURE HELPER PDF: pdfOutput = ' + pdfOutput);

    // The API returns the sys_id directly as a string, not an object
    if (!pdfOutput || pdfOutput == '' || pdfOutput == 'null') {
        gs.error('SIGNATURE HELPER PDF: Failed to create PDF - pdfOutput is empty');
        return null;
    }

    var attachmentSysId = pdfOutput.toString();
    gs.info('SIGNATURE HELPER PDF: PDF created with attachment sys_id = ' + attachmentSysId);

    // Update the attachment to link it to the parent record with proper name
    gs.info('SIGNATURE HELPER PDF: Updating attachment record...');
    var attachmentGR = new GlideRecord('sys_attachment');
    if (attachmentGR.get(attachmentSysId)) {
        gs.info('SIGNATURE HELPER PDF: Attachment record found, updating fields...');
        attachmentGR.table_name = 'x_banun_bunow_si_0_signature_request';
        attachmentGR.table_sys_id = parent.sys_id.toString();
        attachmentGR.file_name = 'Authority_Limits_Comparison_' + parent.number + '.pdf';
        attachmentGR.update();

        gs.info('SIGNATURE HELPER PDF: Successfully created and attached PDF');
        gs.info('SIGNATURE HELPER PDF: Final file name = ' + attachmentGR.file_name);
        return attachmentSysId;
    } else {
        gs.error('SIGNATURE HELPER PDF: Could not retrieve attachment record with sys_id: ' + attachmentSysId);
    }

} catch (e) {
    gs.error('SIGNATURE HELPER PDF: Exception during PDF generation: ' + e.message);
    gs.error('SIGNATURE HELPER PDF: Exception stack: ' + e.stack);
    return null;
}
