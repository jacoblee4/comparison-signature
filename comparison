****** Script include code:

_buildHTMLContent: function(parent) {
        // Function to get value or return 0
        function safeGetValue(glideRecord, fieldName) {
            var value = glideRecord.getValue(fieldName);
            return parseFloat(value) || 0;
        }

        // Function to format currency
        function formatCurrency(value) {
            if (!value || value === 0) return '-';
            return '$' + parseFloat(value).toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }

        // Get the job function description from the requested job code
        var jobCodeGr = new GlideRecord('x_banun_rbac_job_code');
        if (!jobCodeGr.get(parent.getValue('job_code'))) {
            return null;
        }


        var jobFunctionDescription = jobCodeGr.getValue('job_function_description') ||
            jobCodeGr.getValue('u_job_function_description') ||
            jobCodeGr.getValue('job_function');

        // CHANGED: Don't abort if no job function - just won't show comparison
        var hasJobFunction = (jobFunctionDescription != null && jobFunctionDescription != '');
        var jobCodesList = [];
        var existingLimits = [];

        if (hasJobFunction) {
            // Get all job codes with matching job function description
            var jobCodesGr = new GlideRecord('x_banun_rbac_job_code');
            jobCodesGr.addQuery('job_function_description', jobFunctionDescription);
            jobCodesGr.query();

            while (jobCodesGr.next()) {
                jobCodesList.push(jobCodesGr.sys_id.toString());
            }

        }

        // Get the requested limits
        var requestedLimits = {
            job_code: parent.job_code.getDisplayValue(),
            job_code_sys_id: parent.getValue('job_code'),
            sys_id: 'REQUESTED',
            isRequested: true
        };

        // Get job title
        var requestedJobCodeGr = new GlideRecord('x_banun_rbac_job_code');
        if (requestedJobCodeGr.get(parent.getValue('job_code'))) {
            requestedLimits.job_title = requestedJobCodeGr.getValue('job_description') || '';
        }

        // Determine if this is a change request
        var isChangeRequest = (parent.request_type == 'change_to_existing_authority');

        // Fetch credit limits
        var creditGr = new GlideRecord('x_banun_bunow_si_0_credit_authority_limits');
        creditGr.addQuery('parent', parent.sys_id);
        creditGr.query();

        if (creditGr.next()) {
            requestedLimits.overdraft_internal = safeGetValue(creditGr, 'overdraft_internal_accounts');
            requestedLimits.overdraft_external = safeGetValue(creditGr, 'overdraft_external_accounts');
            requestedLimits.unavailable_internal = safeGetValue(creditGr, 'unavailable_funds_internal_accounts');
            requestedLimits.unavailable_external = safeGetValue(creditGr, 'unavailable_funds_external_accounts');

            if (isChangeRequest) {
                requestedLimits.original_overdraft_internal = safeGetValue(creditGr, 'original_overdraft_internal_accounts');
                requestedLimits.original_overdraft_external = safeGetValue(creditGr, 'original_overdraft_external_accounts');
                requestedLimits.original_unavailable_internal = safeGetValue(creditGr, 'original_unavailable_funds_internal_accounts');
                requestedLimits.original_unavailable_external = safeGetValue(creditGr, 'original_unavailable_funds_external_accounts');
            }
        }

        // Fetch non-credit limits
        var nonCreditGr = new GlideRecord('x_banun_bunow_si_0_non_credit_authority_limits');
        nonCreditGr.addQuery('parent', parent.sys_id);
        nonCreditGr.query();

        if (nonCreditGr.next()) {
            requestedLimits.disbursement_ach = safeGetValue(nonCreditGr, 'disbursement_ach');
            requestedLimits.wire_internal = safeGetValue(nonCreditGr, 'disbursement_wire_transfer_internal');
            requestedLimits.wire_external = safeGetValue(nonCreditGr, 'disbursement_wire_transfer_external');
            requestedLimits.checks_internal = safeGetValue(nonCreditGr, 'disbursement_official_checks_internal');
            requestedLimits.checks_external = safeGetValue(nonCreditGr, 'disbursement_official_checks_external');
            requestedLimits.check_cashing_on_us = safeGetValue(nonCreditGr, 'check_cashing_on_us');
            requestedLimits.check_cashing_not_on_us = safeGetValue(nonCreditGr, 'check_cashing_not_on_us');
            requestedLimits.remote_deposit = safeGetValue(nonCreditGr, 'remote_deposit');
            requestedLimits.treasury_wire = safeGetValue(nonCreditGr, 'treasury_solutions_company_wire_limits');
            requestedLimits.fx_wire = safeGetValue(nonCreditGr, 'fx_wire_limits');

            if (isChangeRequest) {
                requestedLimits.original_disbursement_ach = safeGetValue(nonCreditGr, 'original_disbursement_ach');
                requestedLimits.original_wire_internal = safeGetValue(nonCreditGr, 'original_disbursement_wire_transfer_internal');
                requestedLimits.original_wire_external = safeGetValue(nonCreditGr, 'original_disbursement_wire_transfer_external');
                requestedLimits.original_checks_internal = safeGetValue(nonCreditGr, 'original_disbursement_official_checks_internal');
                requestedLimits.original_checks_external = safeGetValue(nonCreditGr, 'original_disbursement_official_checks_external');
                requestedLimits.original_check_cashing_on_us = safeGetValue(nonCreditGr, 'original_check_cashing_on_us');
                requestedLimits.original_check_cashing_not_on_us = safeGetValue(nonCreditGr, 'original_check_cashing_not_on_us');
                requestedLimits.original_remote_deposit = safeGetValue(nonCreditGr, 'original_remote_deposit');
                requestedLimits.original_treasury_wire = safeGetValue(nonCreditGr, 'original_treasury_solutions_company_wire_limits');
                requestedLimits.original_fx_wire = safeGetValue(nonCreditGr, 'original_fx_wire_limits');
            }
        }

        // Define all limit fields
        var limitFields = [
            'disbursement_ach',
            'wire_internal',
            'wire_external',
            'checks_internal',
            'checks_external',
            'check_cashing_on_us',
            'check_cashing_not_on_us',
            'remote_deposit',
            'treasury_wire',
            'fx_wire',
            'overdraft_internal',
            'overdraft_external',
            'unavailable_internal',
            'unavailable_external'
        ];

        // Find the largest requested value
        var largestValue = 0;
        var largestField = '';

        for (var i = 0; i < limitFields.length; i++) {
            var fieldName = limitFields[i];
            var value = requestedLimits[fieldName] || 0;
            if (value > largestValue) {
                largestValue = value;
                largestField = fieldName;
            }
        }

        if (largestValue === 0) {
            return null;
        }

        // Get existing authority limits ONLY if we have a job function
        if (hasJobFunction && jobCodesList.length > 0) {

            for (var j = 0; j < jobCodesList.length; j++) {
                var limitGr = new GlideRecord('x_banun_bunow_si_0_authority_limits');
                limitGr.addQuery('job_code', jobCodesList[j]);
                limitGr.query();

                while (limitGr.next()) {
                    var limit = {
                        job_code: limitGr.job_code.getDisplayValue(),
                        job_code_sys_id: limitGr.getValue('job_code'),
                        sys_id: limitGr.sys_id.toString(),
                        isRequested: false
                    };

                    var jobCodeGr2 = new GlideRecord('x_banun_rbac_job_code');
                    if (jobCodeGr2.get(limitGr.getValue('job_code'))) {
                        limit.job_title = jobCodeGr2.getValue('job_description') || '';
                    }

                    limit.disbursement_ach = safeGetValue(limitGr, 'disbursement_ach');
                    limit.wire_internal = safeGetValue(limitGr, 'disbursement_wire_transfer_internal');
                    limit.wire_external = safeGetValue(limitGr, 'disbursement_wire_transfer_external');
                    limit.checks_internal = safeGetValue(limitGr, 'disbursement_official_checks_internal');
                    limit.checks_external = safeGetValue(limitGr, 'disbursement_official_checks_external');
                    limit.check_cashing_on_us = safeGetValue(limitGr, 'check_cashing_on_us');
                    limit.check_cashing_not_on_us = safeGetValue(limitGr, 'check_cashing_not_on_us');
                    limit.remote_deposit = safeGetValue(limitGr, 'remote_deposit');
                    limit.treasury_wire = safeGetValue(limitGr, 'treasury_solutions_company_wire_limits');
                    limit.fx_wire = safeGetValue(limitGr, 'fx_wire_limits');
                    limit.overdraft_internal = safeGetValue(limitGr, 'overdraft_internal_accounts');
                    limit.overdraft_external = safeGetValue(limitGr, 'overdraft_external_accounts');
                    limit.unavailable_internal = safeGetValue(limitGr, 'unavailable_funds_internal_accounts');
                    limit.unavailable_external = safeGetValue(limitGr, 'unavailable_funds_external_accounts');

                    existingLimits.push(limit);
                }
            }
        }

        existingLimits.push(requestedLimits);

        // Sort by largest field value
        existingLimits.sort(function(a, b) {
            var aVal = a[largestField] || 0;
            var bVal = b[largestField] || 0;
            return bVal - aVal;
        });

        // Function to determine if field should be highlighted
        function shouldHighlight(row, fieldName) {
            if (!row.isRequested) return false;

            var newValue = row[fieldName] || 0;

            if (isChangeRequest) {
                var originalValue = row['original_' + fieldName] || 0;
                return newValue !== originalValue;
            } else {
                return newValue > 0;
            }
        }

       // Build HTML with PDF-optimized styling
var html = '<!DOCTYPE html><html><head>';
html += '<meta charset="UTF-8">';
html += '<style>';
html += '@page { size: landscape; margin: 0.5in; }';
html += 'body { font-family: Arial, sans-serif; margin: 0; padding: 15px; background: white; }';

html += '.report-header { margin-bottom: 20px; border-bottom: 3px solid #0066cc; padding-bottom: 10px; }';
html += '.report-title { color: #0066cc; font-size: 20px; font-weight: bold; margin: 0 0 10px 0; }';
html += '.report-meta { background: #f4f4f4; padding: 10px; border-left: 3px solid #0066cc; margin: 10px 0; }';
html += '.report-meta p { margin: 4px 0; font-size: 11px; color: #333; }';
html += '.report-meta strong { color: #000; font-weight: 600; }';

html += 'h3 { color: #2c3e50; margin: 15px 0 10px 0; font-size: 14px; font-weight: 600; }';
html += '.note { background-color: #fff9e6; padding: 12px; margin: 10px 0; border: 2px solid #ffc107; border-radius: 4px; font-size: 10px; line-height: 1.5; }';

html += 'table { width: 100%; border-collapse: separate; border-spacing: 0; font-size: 9px; margin-top: 15px; }';
html += 'table, th, td { border: 1px solid #ccc; }';

html += 'th.section-header { padding: 10px 4px; text-align: center; font-weight: bold; font-size: 11px; border: 1px solid #ccc; }';
html += 'th.job-info-section { color: #495057; background: #e9ecef !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }';
html += 'th.non-credit-section { color: #155724; background: #d4edda !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }';
html += 'th.credit-section { color: #721c24; background: #f8d7da !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }';

html += 'th.subsection-header { padding: 8px 4px; text-align: center; font-weight: 600; font-size: 10px; border: 1px solid #ccc; }';
html += 'th.subsection-non-credit { background: #e8f5e9 !important; color: #2e7d32 !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }';
html += 'th.subsection-credit { background: #ffebee !important; color: #c62828 !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }';

html += 'th { padding: 6px 4px; text-align: center; font-weight: 600; font-size: 8px; color: #fff; background: #6c757d !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; white-space: normal; vertical-align: middle; line-height: 1.2; }';
html += 'th.non-credit-col { background: #28a745 !important; color: white !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }';
html += 'th.credit-col { background: #dc3545 !important; color: white !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }';

html += 'td { padding: 5px 4px; font-size: 9px; border: 1px solid #ddd; }';
html += 'tr:nth-child(even) { background: #f8f9fa !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }';
html += 'tr:nth-child(odd) { background: white !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }';

html += 'td.job-title { text-align: left; font-weight: 600; color: #2c3e50; background-color: #f8f9fa !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }';
html += 'td.job-code { text-align: center; font-weight: 600; color: #2c3e50; background-color: #f8f9fa !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }';

html += '.requested-row { background-color: #fff3cd !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }';
html += '.requested-row td.job-title, .requested-row td.job-code { background-color: #fff3cd !important; font-weight: 700; -webkit-print-color-adjust: exact; print-color-adjust: exact; }';
html += '.requested-label { color: #FF0000; font-size: 7px; font-weight: 700; display: block; margin-top: 2px; }';

html += 'td.amount-cell { text-align: right; font-weight: 500; color: #2c3e50; }';
html += 'td.non-credit-cell { background: #e8f5e9 !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }';
html += 'td.credit-cell { background: #ffebee !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }';

html += '.highlight { background-color: #ffc107 !important; font-weight: 700 !important; color: #000 !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }';

html += '@media print { ';
html += '  * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }';
html += '  body { margin: 0; padding: 10px; }';
html += '  table { page-break-inside: auto; }';
html += '  tr { page-break-inside: avoid; page-break-after: auto; }';
html += '  thead { display: table-header-group; }';
html += '  th, td { border: 1px solid #999 !important; }';
html += '}';
html += '</style>';
html += '</head><body>';

// Header information
html += '<div class="report-header">';
html += '<div class="report-title">Authority Limits ' + (hasJobFunction ? 'Comparison ' : '') + 'Report</div>';
html += '<div class="report-meta">';
html += '<p><strong>Request Number:</strong> ' + (parent.number || 'N/A') + '</p>';

// Add null check for employee
var employeeName = 'N/A';
if (parent.employee && parent.employee.getDisplayValue) {
    employeeName = parent.employee.getDisplayValue() || 'N/A';
}
html += '<p><strong>Employee:</strong> ' + employeeName + '</p>';

// Add null check for request_type
var requestType = 'N/A';
if (parent.request_type && parent.request_type.getDisplayValue) {
    requestType = parent.request_type.getDisplayValue() || 'N/A';
}
html += '<p><strong>Request Type:</strong> ' + requestType + '</p>';
html += '<p><strong>Generated:</strong> ' + new GlideDateTime().getDisplayValue() + '</p>';
html += '</div>';
html += '</div>';

if (hasJobFunction) {
    html += '<h3>Job Function: ' + jobFunctionDescription + '</h3>';
} else {
    html += '<h3>Requested Authority Limits</h3>';
    html += '<div class="note">⚠️ No job function description is available for this job code, so no comparison with other job codes can be shown.</div>';
}

// Build table with matching structure
html += '<table>';
html += '<thead>';

// Row 1: Main section headers
html += '<tr>';
html += '<th rowspan="3" class="section-header job-info-section">Job Title</th>';
html += '<th colspan="10" class="section-header non-credit-section">Non-Credit Authority</th>';
html += '<th colspan="4" class="section-header credit-section">Credit Authority</th>';
html += '<th rowspan="3" class="section-header job-info-section">Job Code</th>';
html += '</tr>';

// Row 2: Subsection headers
html += '<tr>';
html += '<th colspan="5" class="subsection-header subsection-non-credit">Disbursement</th>';
html += '<th colspan="2" class="subsection-header subsection-non-credit">Check Cashing & Cash Withdrawal</th>';
html += '<th colspan="3" class="subsection-header subsection-non-credit">Product Limits</th>';
html += '<th colspan="2" class="subsection-header subsection-credit">Overdraft</th>';
html += '<th colspan="2" class="subsection-header subsection-credit">Unavailable Funds</th>';
html += '</tr>';

// Row 3: Column headers
html += '<tr>';
html += '<th class="non-credit-col">ACH</th>';
html += '<th class="non-credit-col">Wire Transfer<br/>Internal</th>';
html += '<th class="non-credit-col">Wire Transfer<br/>External</th>';
html += '<th class="non-credit-col">Official Checks<br/>Internal</th>';
html += '<th class="non-credit-col">Official Checks<br/>External</th>';
html += '<th class="non-credit-col">Check Cashing<br/>On-Us</th>';
html += '<th class="non-credit-col">Check Cashing<br/>Not On-Us</th>';
html += '<th class="non-credit-col">Remote<br/>Deposit</th>';
html += '<th class="non-credit-col">Treasury Solutions<br/>Company Wire Limits</th>';
html += '<th class="non-credit-col">FX Wire<br/>Limits</th>';
html += '<th class="credit-col">Overdraft<br/>Internal</th>';
html += '<th class="credit-col">Overdraft<br/>External</th>';
html += '<th class="credit-col">Unavailable Funds<br/>Internal</th>';
html += '<th class="credit-col">Unavailable Funds<br/>External</th>';
html += '</tr>';

html += '</thead><tbody>';

// Table rows
for (var r = 0; r < existingLimits.length; r++) {
    var row = existingLimits[r];
    var rowClass = row.isRequested ? ' class="requested-row"' : '';

    html += '<tr' + rowClass + '>';

    // Job Title
    html += '<td class="job-title">' + (row.job_title || '');
    if (row.isRequested) {
        html += '<span class="requested-label">(REQUESTED)</span>';
    }
    html += '</td>';

    // Disbursement columns (Non-Credit)
    var disbursementFields = ['disbursement_ach', 'wire_internal', 'wire_external', 'checks_internal', 'checks_external'];
    for (var d = 0; d < disbursementFields.length; d++) {
        var field = disbursementFields[d];
        var cellClass = 'amount-cell non-credit-cell';
        if (shouldHighlight(row, field)) {
            cellClass += ' highlight';
        }
        html += '<td class="' + cellClass + '">' + formatCurrency(row[field]) + '</td>';
    }

    // Check Cashing columns (Non-Credit)
    var checkCashingFields = ['check_cashing_on_us', 'check_cashing_not_on_us'];
    for (var cc = 0; cc < checkCashingFields.length; cc++) {
        var field = checkCashingFields[cc];
        var cellClass = 'amount-cell non-credit-cell';
        if (shouldHighlight(row, field)) {
            cellClass += ' highlight';
        }
        html += '<td class="' + cellClass + '">' + formatCurrency(row[field]) + '</td>';
    }

    // Product Limits columns (Non-Credit)
    var productFields = ['remote_deposit', 'treasury_wire', 'fx_wire'];
    for (var p = 0; p < productFields.length; p++) {
        var field = productFields[p];
        var cellClass = 'amount-cell non-credit-cell';
        if (shouldHighlight(row, field)) {
            cellClass += ' highlight';
        }
        html += '<td class="' + cellClass + '">' + formatCurrency(row[field]) + '</td>';
    }

    // Overdraft columns (Credit)
    var overdraftFields = ['overdraft_internal', 'overdraft_external'];
    for (var o = 0; o < overdraftFields.length; o++) {
        var field = overdraftFields[o];
        var cellClass = 'amount-cell credit-cell';
        if (shouldHighlight(row, field)) {
            cellClass += ' highlight';
        }
        html += '<td class="' + cellClass + '">' + formatCurrency(row[field]) + '</td>';
    }

    // Unavailable Funds columns (Credit)
    var unavailableFields = ['unavailable_internal', 'unavailable_external'];
    for (var u = 0; u < unavailableFields.length; u++) {
        var field = unavailableFields[u];
        var cellClass = 'amount-cell credit-cell';
        if (shouldHighlight(row, field)) {
            cellClass += ' highlight';
        }
        html += '<td class="' + cellClass + '">' + formatCurrency(row[field]) + '</td>';
    }

    // Job Code
    html += '<td class="job-code">' + row.job_code;
    if (row.isRequested) {
        html += '<span class="requested-label">(REQUESTED)</span>';
    }
    html += '</td>';

    html += '</tr>';
}

html += '</tbody></table>';

if (existingLimits.length === 1) {
    html += '<div class="note">⚠️ No existing authority limits found for job function <strong>' + (jobFunctionDescription || 'N/A') + '</strong>. Only the requested limits are shown above.</div>';
}

html += '</body></html>';

return html;
