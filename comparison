_buildHTMLContent: function(parent) {
    gs.info('SIGNATURE HELPER HTML: _buildHTMLContent started');
    gs.info('SIGNATURE HELPER HTML: Parent sys_id = ' + parent.sys_id);
    gs.info('SIGNATURE HELPER HTML: Parent number = ' + parent.number);
    
    // Function to get value or return 0
    function safeGetValue(glideRecord, fieldName) {
        var value = glideRecord.getValue(fieldName);
        return parseFloat(value) || 0;
    }

    // Function to format currency
    function formatCurrency(value) {
        if (!value || value === 0) return '-';
        return '$' + parseFloat(value).toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    }

    // Get the job function description from the requested job code
    gs.info('SIGNATURE HELPER HTML: Getting job code...');
    gs.info('SIGNATURE HELPER HTML: Parent job_code value = ' + parent.getValue('job_code'));
    
    var jobCodeGr = new GlideRecord('x_banun_rbac_job_code');
    if (!jobCodeGr.get(parent.getValue('job_code'))) {
        gs.error('SIGNATURE HELPER HTML: Failed to retrieve job code record');
        return null;
    }
    
    gs.info('SIGNATURE HELPER HTML: Job code record retrieved');

    var jobFunctionDescription = jobCodeGr.getValue('job_function_description') ||
        jobCodeGr.getValue('u_job_function_description') ||
        jobCodeGr.getValue('job_function');
    
    gs.info('SIGNATURE HELPER HTML: Job function description = ' + jobFunctionDescription);

    if (!jobFunctionDescription) {
        gs.error('SIGNATURE HELPER HTML: No job function description found - returning null');
        return null;
    }

    // Get all job codes with matching job function description
    gs.info('SIGNATURE HELPER HTML: Querying for matching job codes...');
    var jobCodesList = [];
    var jobCodesGr = new GlideRecord('x_banun_rbac_job_code');
    jobCodesGr.addQuery('job_function_description', jobFunctionDescription);
    jobCodesGr.query();

    while (jobCodesGr.next()) {
        jobCodesList.push(jobCodesGr.sys_id.toString());
    }
    
    gs.info('SIGNATURE HELPER HTML: Found ' + jobCodesList.length + ' matching job codes');

    if (jobCodesList.length === 0) {
        gs.error('SIGNATURE HELPER HTML: No matching job codes found - returning null');
        return null;
    }

    // Get the requested limits
    gs.info('SIGNATURE HELPER HTML: Building requested limits object...');
    var requestedLimits = {
        job_code: parent.job_code.getDisplayValue(),
        job_code_sys_id: parent.getValue('job_code'),
        sys_id: 'REQUESTED',
        isRequested: true
    };

    // Get job title
    var requestedJobCodeGr = new GlideRecord('x_banun_rbac_job_code');
    if (requestedJobCodeGr.get(parent.getValue('job_code'))) {
        requestedLimits.job_title = requestedJobCodeGr.getValue('job_description') || '';
        gs.info('SIGNATURE HELPER HTML: Job title = ' + requestedLimits.job_title);
    }

    // Determine if this is a change request
    var isChangeRequest = (parent.request_type == 'change_to_existing_authority');
    gs.info('SIGNATURE HELPER HTML: Is change request = ' + isChangeRequest);

    // Fetch credit limits
    gs.info('SIGNATURE HELPER HTML: Fetching credit limits...');
    var creditGr = new GlideRecord('x_banun_bunow_si_0_credit_authority_limits');
    creditGr.addQuery('parent', parent.sys_id);
    creditGr.query();

    if (creditGr.next()) {
        gs.info('SIGNATURE HELPER HTML: Credit limits found');
        requestedLimits.overdraft_internal = safeGetValue(creditGr, 'overdraft_internal_accounts');
        requestedLimits.overdraft_external = safeGetValue(creditGr, 'overdraft_external_accounts');
        requestedLimits.unavailable_internal = safeGetValue(creditGr, 'unavailable_funds_internal_accounts');
        requestedLimits.unavailable_external = safeGetValue(creditGr, 'unavailable_funds_external_accounts');

        if (isChangeRequest) {
            requestedLimits.original_overdraft_internal = safeGetValue(creditGr, 'original_overdraft_internal_accounts');
            requestedLimits.original_overdraft_external = safeGetValue(creditGr, 'original_overdraft_external_accounts');
            requestedLimits.original_unavailable_internal = safeGetValue(creditGr, 'original_unavailable_funds_internal_accounts');
            requestedLimits.original_unavailable_external = safeGetValue(creditGr, 'original_unavailable_funds_external_accounts');
        }
    } else {
        gs.info('SIGNATURE HELPER HTML: No credit limits found');
    }

    // Fetch non-credit limits
    gs.info('SIGNATURE HELPER HTML: Fetching non-credit limits...');
    var nonCreditGr = new GlideRecord('x_banun_bunow_si_0_non_credit_authority_limits');
    nonCreditGr.addQuery('parent', parent.sys_id);
    nonCreditGr.query();

    if (nonCreditGr.next()) {
        gs.info('SIGNATURE HELPER HTML: Non-credit limits found');
        requestedLimits.disbursement_ach = safeGetValue(nonCreditGr, 'disbursement_ach');
        requestedLimits.wire_internal = safeGetValue(nonCreditGr, 'disbursement_wire_transfer_internal');
        requestedLimits.wire_external = safeGetValue(nonCreditGr, 'disbursement_wire_transfer_external');
        requestedLimits.checks_internal = safeGetValue(nonCreditGr, 'disbursement_official_checks_internal');
        requestedLimits.checks_external = safeGetValue(nonCreditGr, 'disbursement_official_checks_external');
        requestedLimits.check_cashing_on_us = safeGetValue(nonCreditGr, 'check_cashing_on_us');
        requestedLimits.check_cashing_not_on_us = safeGetValue(nonCreditGr, 'check_cashing_not_on_us');
        requestedLimits.remote_deposit = safeGetValue(nonCreditGr, 'remote_deposit');
        requestedLimits.treasury_wire = safeGetValue(nonCreditGr, 'treasury_solutions_company_wire_limits');
        requestedLimits.fx_wire = safeGetValue(nonCreditGr, 'fx_wire_limits');

        if (isChangeRequest) {
            requestedLimits.original_disbursement_ach = safeGetValue(nonCreditGr, 'original_disbursement_ach');
            requestedLimits.original_wire_internal = safeGetValue(nonCreditGr, 'original_disbursement_wire_transfer_internal');
            requestedLimits.original_wire_external = safeGetValue(nonCreditGr, 'original_disbursement_wire_transfer_external');
            requestedLimits.original_checks_internal = safeGetValue(nonCreditGr, 'original_disbursement_official_checks_internal');
            requestedLimits.original_checks_external = safeGetValue(nonCreditGr, 'original_disbursement_official_checks_external');
            requestedLimits.original_check_cashing_on_us = safeGetValue(nonCreditGr, 'original_check_cashing_on_us');
            requestedLimits.original_check_cashing_not_on_us = safeGetValue(nonCreditGr, 'original_check_cashing_not_on_us');
            requestedLimits.original_remote_deposit = safeGetValue(nonCreditGr, 'original_remote_deposit');
            requestedLimits.original_treasury_wire = safeGetValue(nonCreditGr, 'original_treasury_solutions_company_wire_limits');
            requestedLimits.original_fx_wire = safeGetValue(nonCreditGr, 'original_fx_wire_limits');
        }
    } else {
        gs.info('SIGNATURE HELPER HTML: No non-credit limits found');
    }

    // Define all limit fields
    var limitFields = [
        'disbursement_ach',
        'wire_internal',
        'wire_external',
        'checks_internal',
        'checks_external',
        'check_cashing_on_us',
        'check_cashing_not_on_us',
        'remote_deposit',
        'treasury_wire',
        'fx_wire',
        'overdraft_internal',
        'overdraft_external',
        'unavailable_internal',
        'unavailable_external'
    ];

    // Find the largest requested value
    gs.info('SIGNATURE HELPER HTML: Finding largest requested value...');
    var largestValue = 0;
    var largestField = '';

    for (var i = 0; i < limitFields.length; i++) {
        var fieldName = limitFields[i];
        var value = requestedLimits[fieldName] || 0;
        if (value > largestValue) {
            largestValue = value;
            largestField = fieldName;
        }
    }
    
    gs.info('SIGNATURE HELPER HTML: Largest value = ' + largestValue + ' in field ' + largestField);

    if (largestValue === 0) {
        gs.error('SIGNATURE HELPER HTML: No authority limits specified (largestValue = 0) - returning null');
        return null;
    }

    // Get existing authority limits
    gs.info('SIGNATURE HELPER HTML: Fetching existing authority limits...');
    var existingLimits = [];

    for (var j = 0; j < jobCodesList.length; j++) {
        var limitGr = new GlideRecord('x_banun_bunow_si_0_authority_limits');
        limitGr.addQuery('job_code', jobCodesList[j]);
        limitGr.query();

        while (limitGr.next()) {
            var limit = {
                job_code: limitGr.job_code.getDisplayValue(),
                job_code_sys_id: limitGr.getValue('job_code'),
                sys_id: limitGr.sys_id.toString(),
                isRequested: false
            };

            var jobCodeGr2 = new GlideRecord('x_banun_rbac_job_code');
            if (jobCodeGr2.get(limitGr.getValue('job_code'))) {
                limit.job_title = jobCodeGr2.getValue('job_description') || '';
            }

            limit.disbursement_ach = safeGetValue(limitGr, 'disbursement_ach');
            limit.wire_internal = safeGetValue(limitGr, 'disbursement_wire_transfer_internal');
            limit.wire_external = safeGetValue(limitGr, 'disbursement_wire_transfer_external');
            limit.checks_internal = safeGetValue(limitGr, 'disbursement_official_checks_internal');
            limit.checks_external = safeGetValue(limitGr, 'disbursement_official_checks_external');
            limit.check_cashing_on_us = safeGetValue(limitGr, 'check_cashing_on_us');
            limit.check_cashing_not_on_us = safeGetValue(limitGr, 'check_cashing_not_on_us');
            limit.remote_deposit = safeGetValue(limitGr, 'remote_deposit');
            limit.treasury_wire = safeGetValue(limitGr, 'treasury_solutions_company_wire_limits');
            limit.fx_wire = safeGetValue(limitGr, 'fx_wire_limits');
            limit.overdraft_internal = safeGetValue(limitGr, 'overdraft_internal_accounts');
            limit.overdraft_external = safeGetValue(limitGr, 'overdraft_external_accounts');
            limit.unavailable_internal = safeGetValue(limitGr, 'unavailable_funds_internal_accounts');
            limit.unavailable_external = safeGetValue(limitGr, 'unavailable_funds_external_accounts');

            existingLimits.push(limit);
        }
    }
    
    gs.info('SIGNATURE HELPER HTML: Found ' + existingLimits.length + ' existing authority limits');

    existingLimits.push(requestedLimits);

    // Sort by largest field value
    existingLimits.sort(function(a, b) {
        var aVal = a[largestField] || 0;
        var bVal = b[largestField] || 0;
        return bVal - aVal;
    });

    // Function to determine if field should be highlighted
    function shouldHighlight(row, fieldName) {
        if (!row.isRequested) return false;

        var newValue = row[fieldName] || 0;

        if (isChangeRequest) {
            var originalValue = row['original_' + fieldName] || 0;
            return newValue !== originalValue;
        } else {
            return newValue > 0;
        }
    }

    // Build HTML with PDF-optimized styling
    gs.info('SIGNATURE HELPER HTML: Building HTML content...');
    var html = '<!DOCTYPE html><html><head>';
    
    // ... rest of your HTML building code ...
    
    gs.info('SIGNATURE HELPER HTML: HTML content built successfully, length = ' + html.length);
    return html;
},
